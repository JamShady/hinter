"use strict";var d=Object.defineProperty;var w=(n,e,s)=>e in n?d(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var m=(n,e,s)=>w(n,typeof e!="symbol"?e+"":e,s);class x{keywordRegex(e){return"\\s*(?:"+e.join(":?|")+":?)\\s+"}contentRegex(){return"(.*?)"}regex(e,s,r){return e+this.keywordRegex(s)+this.contentRegex()+r}matches(e,s,r,t="$"){const l=this.regex(r,s,t),a=new RegExp(l,"misg"),i=new RegExp(l,"mis");return(e.match(a)||[]).map(o=>{const h=o.match(i);if(h){const[u,c]=h;return{full:u,curr:c,hint:c}}}).filter(o=>!!o)}}class y extends x{matches(e,s){return super.matches(e,s,"//")}}class k extends x{matches(e,s){return super.matches(e,s,"#")}}class g extends x{keywordRegex(){return""}removeKeyWord(e){return e.trim().split(/\s+/).slice(1).join(" ")}matches(e,s,r,t,l=a=>a){return super.matches(e,s,r,t).map(a=>{const i=a.hint.trim().split(/\n/);for(;i.length;){const h=l(i[0]).trim();if(s.some(u=>h.startsWith(u))){i[0]=h;break}else i.shift()}const o=i.join(`
`);return{...a,curr:o,hint:this.removeKeyWord(o)}}).filter(a=>a.hint.length)}}class $ extends g{matches(e,s){return super.matches(e,s,"<!-{2,}","-{2,}>")}}class j extends g{matches(e,s){return super.matches(e,s,"/\\*+","\\*+/",r=>r.replace(/^\s*\*+/,""))}}class R{matches(e,s,r={}){const t=[],l=Object.keys(r);if(!l.length)return t;const a=l.map(c=>({plural:c,single:c.replace(/ies$/,"y").replace(/s$/,"")})).filter(({single:c})=>["${","."].some(p=>e.includes(p+c+"}"))).map(({plural:c,single:p})=>({[p]:c})).reduce((c,p)=>({...c,...p}),{}),i=Object.keys(a);if(!i.length)return t;const o="\\${(?:\\w+\\.)*("+i.join("|")+")}",h=new RegExp(o,"g"),u=new RegExp(["[^\\s'`\"]*",o,"[^\\s'`\"]*"].join(""),"gm");return(e.match(u)||t).filter((c,p,f)=>f.indexOf(c)===p).map(c=>({full:c,curr:c,hint:c.replace(h,(p,f)=>"$"+a[f])}))}}const E=[new y,new k,new $,new j,new R];class b{constructor(){m(this,"hints",e=>e.trim().split(/\s+/).map(s=>s.trim()).filter((s,r,t)=>t.indexOf(s)===r));m(this,"optional",e=>e.replaceAll(")?","|)"));m(this,"expand",e=>{if(e.includes("(")&&e.includes(")")){const s=e.match(/\(([^*(]+?)\)/);if(s)return s[1].split("|").map(r=>e.replace(s[0],r)).map(this.expand).flat()}return[e]});m(this,"replace",(e,s)=>(Object.keys(s).sort((t,l)=>l.length-t.length).forEach(t=>{e.includes(`$${t}`)&&(e=e.replaceAll(`$${t}`,`(${s[t].join("|")})`))}),e));m(this,"processWith",e=>s=>{if(s=this.replace(s,e),s.includes("=")){const[r,t]=s.split("=");return e[r]=t.split("|"),[]}return this.expand(s)});m(this,"parse",(e,s={})=>this.hints(this.optional(e)).map(this.processWith(s)).flat().filter((r,t,l)=>l.indexOf(r)===t))}}const O=(n,e={},s="hint")=>{const r=Array.isArray(s)?s:[s],t=new b;return E.forEach(l=>l.matches(n,r,e).forEach(({full:a,curr:i,hint:o})=>{n=n.replace(a,a.replace(i," "+t.parse(o,e).join(" ")+" "))})),n};module.exports=O;
